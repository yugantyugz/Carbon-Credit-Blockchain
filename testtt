import pandas as pd

# Step 1: Convert stmt (list of dictionaries) into a Pandas DataFrame
# Example stmt data structure:
# stmt = [
#     {'CURRENCY': 'USD', 'METRIC': 'PV01'},
#     {'CURRENCY': 'EUR', 'METRIC': 'PV01'},
#     {'CURRENCY': 'USD', 'METRIC': 'EQ 01'},
#     {'CURRENCY': 'GBP', 'METRIC': 'CR 01'},
#     # Add more rows here...
# ]
df = pd.DataFrame(stmt)

# Step 2: Generate the SQL query dynamically
columns = []
for _, row in df.iterrows():
    currency = row['CURRENCY']
    metric = row['METRIC']
    col_name = f'"{currency} {metric}"'
    case_statement = f"MAX(CASE WHEN Currency = '{currency}' AND Metric = '{metric}' THEN Value END) AS {col_name}"
    columns.append(case_statement)

# Step 3: Construct the final SQL query
final_query = f"""
SELECT
    ID,
    Name,
    {', '.join(columns)}
FROM sensitivity
GROUP BY ID, Name;
"""

# Step 4: Output the dynamically generated query
print("Generated SQL Query:")
print(final_query)
